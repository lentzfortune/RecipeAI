
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>RecipAI â€” Fridge Chat (Proxy)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{ --bg:#0a0f1f; --bg2:#0c1630; --glass:#10203f; --card:#0f1b37; --paper:#fdfcf7;
           --text:#eaf2ff; --muted:#a9b8d6; --brand:#6bd1ff; --brand2:#9a6bff; --accent:#ffb86b; --ring: rgba(107,209,255,.3); }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Arial;color:var(--text);
      background: radial-gradient(1200px 800px at -10% -20%, rgba(107,209,255,.18), transparent 60%),
                  radial-gradient(1200px 800px at 120% -10%, rgba(154,107,255,.12), transparent 60%),
                  linear-gradient(180deg,var(--bg),var(--bg2)); }
    header{ position:sticky;top:0;z-index:100;background:linear-gradient(180deg,rgba(10,15,31,.9),rgba(10,15,31,.65));backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(255,255,255,.06); padding:12px 0; }
    .wrap{max-width:960px;margin:0 auto;padding:0 16px;display:flex;align-items:center;gap:14px}
    .fridge{width:56px;height:72px;position:relative}
    .fridge svg{filter: drop-shadow(0 8px 20px rgba(0,0,0,.25));}
    .brand{font-weight:900;font-size:20px;letter-spacing:.2px}
    .tag{font-size:12px;color:var(--muted)}
    main{max-width:960px;margin:0 auto;padding:18px 16px 130px}
    .chat{display:flex;flex-direction:column;gap:14px}
    .bubble{max-width:78%;padding:12px 14px;border-radius:16px;line-height:1.55;border:1px solid rgba(255,255,255,.08);white-space:pre-wrap;
      box-shadow:0 10px 24px rgba(0,0,0,.22), 0 2px 8px rgba(0,0,0,.25); background:var(--card);}
    .user{align-self:flex-end;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#061021}
    .paper{ background:var(--paper); color:#111827; border:1px solid #e7e2d4; border-radius:10px; padding:12px;
      box-shadow:0 6px 14px rgba(0,0,0,.25); position:relative;}
    .magnet{position:absolute; top:-10px; left:12px; width:16px; height:16px; border-radius:50%;
      background:linear-gradient(135deg,#ff7474,#ffae70); box-shadow:0 3px 6px rgba(0,0,0,.25);}
    .pill{display:inline-block;padding:6px 9px;border:1px solid rgba(255,255,255,.08);border-radius:999px;background:#0d1732;font-size:12px;margin:3px;color:var(--muted)}
    .composer-wrap{position:fixed;left:0;right:0;bottom:0;z-index:9999;background:linear-gradient(180deg,rgba(10,18,36,0),rgba(10,18,36,.96));border-top:1px solid rgba(255,255,255,.06)}
    .composer{max-width:960px;margin:0 auto;padding:12px 16px}
    .row{display:flex;gap:8px;align-items:stretch}
    textarea{flex:1;padding:12px 14px;border-radius:16px;border:1px solid rgba(255,255,255,.08);
      background:var(--glass);color:var(--text);resize:none;min-height:44px;outline:none;
      box-shadow: inset 0 0 0 2px transparent; transition: box-shadow .2s ease;}
    textarea:focus{ box-shadow: inset 0 0 0 2px var(--ring); }
    .btn{min-width:120px;border:0;border-radius:14px;padding:0 18px;font-weight:800;
      background:linear-gradient(135deg,var(--brand),var(--brand2));color:#001229;cursor:pointer;box-shadow:0 8px 20px rgba(107,209,255,.35)}
    .btn:active{ transform: translateY(1px); }
    .attach{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:12px;border:1px dashed rgba(255,255,255,.18);background:#0d1830;color:var(--muted);cursor:pointer}
    .status{font-size:12px;color:var(--muted);margin-top:8px;min-height:18px}
    .meta{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:8px}
    .meta input,.meta select{width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0d1830;color:var(--text);outline:none}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="fridge" aria-hidden="true">
      <svg viewBox="0 0 64 80" width="56" height="72">
        <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#e9f7ff"/><stop offset="1" stop-color="#bfe7ff"/></linearGradient></defs>
        <rect x="6" y="6" rx="10" ry="10" width="52" height="68" fill="url(#g)" stroke="#a5c7de" stroke-width="1"/>
        <line x1="6" y1="40" x2="58" y2="40" stroke="#a5c7de" stroke-width="1"/>
        <rect x="50" y="20" width="4" height="14" rx="2" fill="#f3fbff" stroke="#b9d3e6" stroke-width="1"/>
        <rect x="50" y="46" width="4" height="14" rx="2" fill="#f3fbff" stroke="#b9d3e6" stroke-width="1"/>
      </svg>
    </div>
    <div><div class="brand">RecipAI</div><div class="tag">What's in your kitchen â†’ What's for dinner</div></div>
  </div>
</header>

<main>
  <div id="chat" class="chat">
    <div class="bubble paper">
      <div class="magnet" aria-hidden="true"></div>
      <b>Pinâ€‘note:</b> Upload a photo of <em>fridge, pantry, or ingredients</em> â€” or just paste a list. Iâ€™ll suggest a recipe, show whatâ€™s missing, and find cheap options.
    </div>
  </div>
</main>

<div class="composer-wrap">
  <div class="composer">
    <div class="meta">
      <input id="servings" type="number" min="1" max="8" value="2" placeholder="Servings">
      <select id="diet"><option value="none">Diet: None</option><option value="vegetarian">Diet: Vegetarian</option><option value="halal">Diet: Halal</option><option value="gluten-free">Diet: Glutenâ€‘free</option></select>
      <input id="timeLimit" type="number" min="5" max="180" value="30" placeholder="Max minutes">
      <input id="budget" type="number" min="1" max="200" value="12" placeholder="Budget ($)">
    </div>
    <div class="row" style="margin-top:8px">
      <label class="attach" for="img">ðŸ“· Attach ingredients photo</label>
      <input id="img" type="file" accept="image/*" style="display:none">
      <textarea id="msg" rows="1" placeholder="Type ingredients or ask for a recipeâ€¦"></textarea>
      <button class="btn" id="send">âž¤ Send</button>
    </div>
    <div class="status" id="status">Ready â€” enter text or attach a photo.</div>
  </div>
</div>

<script>
const ENDPOINT = "http://localhost:5050/invoke"; // <-- local proxy to avoid CORS and hide API key

const chat = document.getElementById("chat");
const msg  = document.getElementById("msg");
const img  = document.getElementById("img");
const statusEl = document.getElementById("status");
let busy = false;

function bubble(role, html){
  const d = document.createElement("div");
  d.className = "bubble " + (role==="user"?"user":"");
  d.innerHTML = html;
  chat.appendChild(d); d.scrollIntoView({behavior:"smooth"});
}
function setStatus(t){ statusEl.textContent = t; }

async function call(url, form){
  const r = await fetch(url, { method:"POST", body: form });
  const text = await r.text();
  return { ok: r.ok, status: r.status, text, url };
}

async function onSend(){
  if (busy) return;
  const text = msg.value.trim();
  const hasImage = !!img.files[0];
  if (!text && !hasImage){ bubble("", "Please type ingredients or attach a photo first."); return; }

  bubble("user", text || "(sent a photo)");
  msg.value = ""; setStatus("Contacting RecipAIâ€¦"); busy = true;

  const form = new FormData();
  // The proxy forwards all fields to the NeuralSeek endpoint
  form.append("agent", "RecipAI");
  if (hasImage) form.append("ingredientsImage", img.files[0]);
  form.append("ingredientsText", text);
  form.append("servings", document.getElementById("servings").value);
  form.append("diet", document.getElementById("diet").value);
  form.append("timeLimit", document.getElementById("timeLimit").value);
  form.append("budget", document.getElementById("budget").value);

  try {
    let res = await call(ENDPOINT, form);
    if (!res.ok){
      bubble("", "Couldnâ€™t reach the recipe engine.<br><b>Status:</b> "+res.status+"<br><b>Endpoint:</b> "+res.url+"<br><b>Response:</b> "+(res.text||"(empty)"));
      setStatus("Error â€” "+res.status); return;
    }
    let data;
    try { data = JSON.parse(res.text); } catch(e){
      bubble("", "Got a nonâ€‘JSON response:<br><pre>"+res.text.replace(/[<>&]/g,s=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[s]))+"</pre>");
      setStatus("Error â€” nonâ€‘JSON"); return;
    }
    renderRecipe(data);
    setStatus("Ready");
  } catch(err){
    bubble("", "Network error: "+err.message);
    setStatus("Error â€” network");
  } finally {
    busy = false; img.value = "";
  }
}

function renderRecipe(data){
  const title = (data.recipes && data.recipes[0]) ? `ðŸ³ ${data.recipes[0]}` : "Your recipe";
  const used = (data.usedItems||[]).map(x=>`<span class='pill'>${x}</span>`).join("") || "â€”";
  const missing = (data.missingItems||[]).map(x=>`<span class='pill'>${x}</span>`).join("") || "None";
  const cheap = (data.cheapOptions||[]).map(o=>`<div>â€¢ <b>${o.item}</b> â€” $${o.price} â€” ${o.store||""}</div>`).join("") || "â€”";
  const steps = (data.instructions||[]).map((s,i)=>`<div>${i+1}. ${s}</div>`).join("");
  const note = data.nutrition ? "<div style='margin-top:8px'><b>Nutrition (est.)</b><br>"+Object.entries(data.nutrition).map(([k,v])=>`â€¢ ${k}: ${v}`).join("<br>")+"</div>" : "";
  const html = `<div class="paper"><div class="magnet"></div><div><b>${title}</b></div>
    <div style="margin-top:8px"><b>Used</b><br>${used}</div>
    <div style="margin-top:8px"><b>Missing</b><br>${missing}</div>
    <div style="margin-top:8px"><b>Cheap options</b><br>${cheap}</div>
    <div style="margin-top:8px"><b>Steps</b><br>${steps}</div>${note}</div>`;
  bubble("", html);
}

document.getElementById("send").addEventListener("click", onSend);
document.getElementById("msg").addEventListener("keydown", (e)=>{ if(e.key==="Enter" && !e.shiftKey){ e.preventDefault(); onSend(); }});
</script>
</body>
</html>
